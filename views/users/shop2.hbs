<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
  
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Free HTML Templates" name="keywords">
    <meta content="Free HTML Templates" name="description">

    <!-- Favicon -->
    <link href="/img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet"> 

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="/css/style.css" rel="stylesheet">
    <!-- Include Bootstrap CSS and JS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>

<style>
    .card-header.product-img {
       /* Adjust the height as needed to make the images align properly */
      display: flex;
      justify-content: center;
      align-items: center;
    }
  
    .card-header.product-img img {
      max-height: 100%;
      max-width: 100%;
      object-fit: cover; /* or 'contain' if you want the whole image to be visible */
    }
  </style>
  
</head>

<body>
    <!-- Shop Start -->
    <div class="container-fluid pt-5">
        <div class="row px-xl-5">
            <!-- Shop Sidebar Start -->
            <div class="col-lg-3 col-md-6 col-12">
                <!-- Price Start -->
                <div class="border-bottom mb-4 pb-4">
                    <h5 class="font-weight-semi-bold mb-4">Filter by price</h5>
                    <form>
                        <div class="custom-control custom-radio d-flex align-items-center justify-content-between mb-3">
                            <input type="radio" class="custom-control-input" checked id="price-all" name="price-filter" value="All">
                            <label class="custom-control-label" for="price-all">All Price</label>
                        </div>
                        <div class="custom-control custom-radio d-flex align-items-center justify-content-between mb-3">
                            <input type="radio" class="custom-control-input" id="price-1" name="price-filter" value="10000-20000 ">
                            <label class="custom-control-label" for="price-1">₹10000 - ₹20000</label>
                        </div>
                        <div class="custom-control custom-radio d-flex align-items-center justify-content-between mb-3">
                            <input type="radio" class="custom-control-input" id="price-2" name="price-filter" value="20000-50000">
                            <label class="custom-control-label" for="price-2">₹20000 - ₹50000</label>
                        </div>
                        <div class="custom-control custom-radio d-flex align-items-center justify-content-between mb-3">
                            <input type="radio" class="custom-control-input" id="price-3" name="price-filter" value="50000-80000">
                            <label class="custom-control-label" for="price-3">₹50000 - ₹80000</label>
                        </div>
                        <div class="custom-control custom-radio d-flex align-items-center justify-content-between mb-3">
                            <input type="radio" class="custom-control-input" id="price-4" name="price-filter" value="80000-100000">
                            <label class="custom-control-label" for="price-4">₹80000 - ₹100000</label>
                        </div>
                        <div class="custom-control custom-radio d-flex align-items-center justify-content-between">
                            <input type="radio" class="custom-control-input" id="price-5" name="price-filter" value="100000-150000">
                            <label class="custom-control-label" for="price-5">₹100000 - ₹150000</label>
                        </div>
                    
                </div>
                
                <!-- Price End -->
                
                <!-- Color Start -->
                <div class="border-bottom mb-4 pb-4">
                    <h5 class="font-weight-semi-bold mb-4">Filter by brands</h5>

                        <div class="custom-control custom-radio d-flex align-items-center justify-content-between mb-3">
                            <input type="radio" class="custom-control-input" checked id="brand-all" name="brand-filter" value="all category">
                            <label class="custom-control-label" for="brand-all">All Category</label>
                        </div>
                       
                        <div class="custom-control custom-radio d-flex align-items-center justify-content-between mb-3">
                            <input type="radio" class="custom-control-input" id="brand-3" name="brand-filter" value="LAPTOP">
                            <label class="custom-control-label" for="brand-3">LAPTOP</label>
                        </div>
                        <div class="custom-control custom-radio d-flex align-items-center justify-content-between mb-3">
                            <input type="radio" class="custom-control-input" id="brand-1" name="brand-filter" value="MOBILE">
                            <label class="custom-control-label" for="brand-1">MOBILE</label>
                        </div>
                        
                      
                    
                </div>

                <!-- Color End -->

                <!-- Size Start -->
                <!-- <div class="mb-5">
                    <h5 class="font-weight-semi-bold mb-4">Filter by size</h5>
                    <form>
                        <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                            <input type="checkbox" class="custom-control-input" checked id="size-all"> 
                            <label class="custom-control-label" for="size-all">All Size</label>
                            <span class="badge border font-weight-normal">1000</span>
                        </div>
                        <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                            <input type="checkbox" class="custom-control-input" id="size-1">
                            <label class="custom-control-label" for="size-1">XS</label>
                            <span class="badge border font-weight-normal">150   </span>
                        </div>
                        <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                            <input type="checkbox" class="custom-control-input" id="size-2">
                            <label class="custom-control-label" for="size-2">S</label>
                            <span class="badge border font-weight-normal">295</span>
                        </div>
                        <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                            <input type="checkbox" class="custom-control-input" id="size-3">
                            <label class="custom-control-label" for="size-3">M</label>
                            <span class="badge border font-weight-normal">246</span>
                        </div>
                        <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                            <input type="checkbox" class="custom-control-input" id="size-4">
                            <label class="custom-control-label" for="size-4">L</label>
                            <span class="badge border font-weight-normal">145</span>
                        </div>
                        <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between">
                            <input type="checkbox" class="custom-control-input" id="size-5">
                            <label class="custom-control-label" for="size-5">XL</label>
                            <span class="badge border font-weight-normal">168</span>
                        </div>
                    </form>
                </div> -->
                <!-- Size End -->
            </div>
            <!-- Shop Sidebar End -->


            <!-- Shop Product Start -->
            <div class="col-lg-9 col-md-6 col">
                <div class="row pb-3 ">
                    <div class="col-12 pb-1">
                        <div class="d-flex align-items-center justify-content-between mb-4">
                            
                            <div class="input-group">
                                <input type="text" class="form-control" id="searchInput" placeholder="Search by name">
                                <div class="input-group-append">
                                    <span class="input-group-text bg-transparent text-primary">
                                        <i class="fa fa-search"></i>
                                    </span>
                                </div>
                                <!-- <button type="button" class="btn btn-primary" id="searchButton">Search</button> -->
                            </div>
                            
                            
                          <div class="dropdown">
                     <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                       Sort by
                    </button>
                   <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                 <a class="dropdown-item" href="#" data-sortby="price-low-high">Price low - high</a>
                  <a class="dropdown-item" href="#" data-sortby="price-high-low">Price high - low</a>
                   </div>
                   </div>      
                        </div>
                    </div>


                    <div class="row pb-3 productListContainer " style="width: 986px;">
                    
              
              {{#each product}}          
            <div class="col-lg-4 col-md-6 col-sm-12 pb-1 ">
             <div class="card product-item border-0 mb-4">
            <div class="card-header  position-relative overflow-hidden bg-transparent border p-0" style="width: 298px; height:370px;">
                <img class="img-fluid w-100" src="/uploads/{{this.images.[0]}}" alt="">
            </div>
            <div class="card-body border-left border-right text-center p-0 pt-4 pb-3">
                <h6 class="text-truncate mb-3"> "{{this.productname}}"  </h6>
                <div class="d-flex justify-content-center">
                    <h6>₹{{this.price}}</h6>
                    <h6 class="text-muted ml-2"><del>  </del></h6>
                 </div>
            </div>
            <div class="card-footer d-flex justify-content-between bg-light border">
                <a href="/load-product?id={{this._id}}" class="btn btn-sm text-dark p-0"><i class="fas fa-eye text-primary mr-1"></i>View Detail</a>

            </div>
           </div>
             </div>
              {{/each}}
          
            
            </div>
       


                   
                  
                    
                   
                   
                   
                 
             <div class="col-12 pb-1" style="margin-top: 225px;">
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center mb-3" id="pagination">
                        

                    </ul>
                </nav>
            </div>
            
                </div>
            </div>
            <!-- Shop Product End -->
        </div>
    </div>
    <!-- Shop End -->




    <!-- Back to Top -->
    <a href="#" class="btn btn-primary back-to-top"><i class="fa fa-angle-double-up"></i></a>


    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="/lib/easing/easing.min.js"></script>
    <script src="/lib/owlcarousel/owl.carousel.min.js"></script>

    <!-- Contact Javascript File -->
    <script src="/mail/jqBootstrapValidation.min.js"></script>
    <script src="/mail/contact.js"></script>

    <!-- Template Javascript -->
    <script src="/javascripts/shopmain.js"></script>
</body>

</html>

<script>
const dropdownButton = document.getElementById('dropdownMenuButton');
const dropdownItems = document.querySelectorAll('.dropdown-item');

dropdownItems.forEach(item => {
    item.addEventListener('click', function (event) {
        event.preventDefault();
        const selectedSortBy = this.dataset.sortby;
        dropdownButton.textContent = this.textContent;
        // Call the function to fetch and update the product list based on the selected sort option
        // For example: updateProductList(selectedSortBy);
    });
});

</script>

     <script>
                $(document).ready(function () {
                        function updateProductList(products) {
            console.log(products);
            console.log('hai');
            const productListContainer = $('.productListContainer');
            productListContainer.empty();

            const productCards = products.map(product => `
            <div class="col-lg-4 col-md-6 col-sm-12 pb-1" style="height:315px">
                <div class="card product-item border-0 mb-4">
                    <div class="card-header  position-relative overflow-hidden bg-transparent border p-0" style="width: 298px; height:370px;">
                        <img class="img-fluid w-100" src="/uploads/${product.images[0]}" alt="">
                    </div>
                    <div class="card-body border-left border-right text-center p-0 pt-4 pb-3">
                        <h6 class="text-truncate mb-3">${product.productname}</h6>
                        <div class="d-flex justify-content-center">
                            <h6>${product.price}</h6><h6 class="text-muted ml-2"></h6>
                        </div>
                    </div>
                    <div class="card-footer d-flex justify-content-center bg-light border">
                <a href="/load-product?id=${product._id}" class="btn btn-sm text-dark p-0"><i class="fas fa-eye text-primary mr-1"></i>View Detail</a>
                        
                    </div>
                </div>
            </div>
            `);

            productListContainer.append(productCards.join(''));
        }   
 

        function createPaginationLinks(totalPages, currentPage) {
        const paginationContainer = $('#pagination');
        paginationContainer.empty();

        // Previous Page Link
        paginationContainer.append(`
            <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                <a class="page-link" href="#" aria-label="Previous" data-page="${currentPage - 1}">
                    <span aria-hidden="true">&laquo;</span>
                    <span class="sr-only">Previous</span>
                </a>
            </li>
        `);

        // Individual Page Links
        for (let i = 1; i <= totalPages; i++) {
            paginationContainer.append(`
                <li class="page-item ${currentPage === i ? 'active' : ''}">
                    <a class="page-link" href="#" data-page="${i}">${i}</a>
                </li>
            `);
        }

        // Next Page Link
        paginationContainer.append(`
            <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                <a class="page-link" href="#" aria-label="Next" data-page="${currentPage + 1}">
                    <span aria-hidden="true">&raquo;</span>
                    <span class="sr-only">Next</span>
                </a>
            </li>
        `);
    }

        
        // Update the pagination links based on the response data
    function updatePaginationLinks(response) {
        const { currentPage, totalPages } = response;
        createPaginationLinks(totalPages, currentPage);
    }

                        function makeAjaxRequest(dataObj){

                            const {selectedSort,selectedPriceRange,selectedCategory,searchQuery,selectedPage} =dataObj
                    
                    console.log(selectedSort,selectedPriceRange,selectedCategory,searchQuery,selectedPage);
                            $.ajax({
                            url:`/shop-page?selectedSort=${selectedSort}&selectedPriceRange=${selectedPriceRange}&selectedCategory=${selectedCategory}&searchQuery=${searchQuery}&selectedPage=${selectedPage}`,
                                method:'post',
                                success:(response)=>{
                                    console.log('RRR',response);
                                    const products = response.products
                                    
                                    updateProductList(products)
                                    updatePaginationLinks(response);
                                    
                                }
                            })
                        }
                        const debouncedMakeAjaxRequest = _.debounce(makeAjaxRequest, 500);


                    // Initial data object with default values
                let dataObj = {
                    selectedSort:'All',
                    selectedPriceRange: 'All', // Default value for price filter
                    selectedCategory: 'all category', // Default value for brand filter
                    searchQuery: '', // Default value for search query
                    selectedPage: 1, // Default value for pagination page
                };
                // Add a change event listener to the radio buttons


                $('.dropdown-item').on('click', function (event) {
                    event.preventDefault();
                    const selectedSort = $(this).data('sortby'); // Get the 'data-sortby' attribute value from the clicked element
                dataObj.selectedSort =selectedSort
                    makeAjaxRequest(dataObj)
                });

                $('input[name="price-filter"]').on('change', function () {
                    // Get the value of the selected radio button
                    const selectedPriceRange = $('input[name="price-filter"]:checked').val();
                    dataObj.selectedPriceRange=selectedPriceRange
                makeAjaxRequest(dataObj)
                
                });
                $('input[name="brand-filter"]').on('change',()=>{
                        const selectedCategory = $('input[name="brand-filter"]:checked').val()
                        
                    dataObj.selectedCategory = selectedCategory
                    makeAjaxRequest(dataObj)
                
                    })

        // Add a change event listener to the search input field
        $('#searchInput').on('input', function () {
                    // Get the search query value
                    const searchQuery = $(this).val().trim();

                    dataObj.searchQuery = searchQuery
                    makeAjaxRequest(dataObj)
                
            }); 
            // Add a click event listener to the pagination links
           // Use event delegation to handle click events on pagination links
$(document).on('click', '.page-link', function (event) {
    event.preventDefault();
    const selectedPage = $(this).data('page');
    dataObj.selectedPage = selectedPage;
    makeAjaxRequest(dataObj);
});

            makeAjaxRequest(dataObj)


           

            
            })


            
    
</script>
